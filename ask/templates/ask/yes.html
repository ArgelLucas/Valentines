{#ask/templates/ask/yes.html#}
{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
  <title>Book &amp; Quill</title>
  <link rel="stylesheet" href="{% static 'ask/css/style.css' %}">

  <style>
    /* ============================================================
       BOOK & QUILL (Minecraft-ish UI) ‚Äî readable + more accurate
       - Dark ink text (no white inheritance)
       - Sharper ‚Äúpixel-ish‚Äù edges
       - Stronger parchment texture + vignette
       - MC-style buttons
       Keeps your existing background canvas + app.js
       ============================================================ */

    /* Keep your existing animated background canvas; style only the book content */
    .alt-page .stage{
      min-height: 100vh;
      display:flex;
      align-items:center;
      justify-content:center;
      padding: 24px 16px;
      position: relative;
      z-index: 1;
    }

    .mc-book-wrap{
      width: min(980px, 92vw);
      position: relative;
      filter: drop-shadow(0 18px 30px rgba(0,0,0,.35));
    }

    /* Outer book frame (sharper, more ‚ÄúUI‚Äù than rounded) */
    .mc-book{
      width: 100%;
      aspect-ratio: 16 / 9;
      min-height: 360px;
      border-radius: 8px;
      background:
        linear-gradient(180deg, rgba(255,255,255,.08), rgba(0,0,0,.14)),
        linear-gradient(90deg, #6a3c1c, #7a451f 18%, #5a3217 50%, #7a451f 82%, #6a3c1c);
      border: 3px solid rgba(0,0,0,.50);
      box-shadow:
        inset 0 0 0 2px rgba(255,255,255,.10),
        inset 0 0 0 6px rgba(0,0,0,.10);
      position: relative;
      overflow: hidden;
      image-rendering: pixelated;
    }

    /* Inner ‚Äúbezel‚Äù like Minecraft GUIs */
    .mc-book::before{
      content:"";
      position:absolute;
      inset: 10px;
      border-radius: 6px;
      border: 2px solid rgba(0,0,0,.45);
      box-shadow: inset 0 0 0 2px rgba(255,255,255,.10);
      pointer-events:none;
      opacity:.9;
    }

    /* Pages layout */
    .mc-pages{
      position:absolute;
      inset: 18px;
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 14px;
      z-index: 1;
    }

    /* Parchment page: more texture + vignette */
    .mc-page{
      border-radius: 6px;
      border: 2px solid rgba(0,0,0,.28);
      background:
        /* subtle fibers */
        repeating-linear-gradient(
          90deg,
          rgba(0,0,0,.025) 0 1px,
          transparent 1px 6px
        ),
        repeating-linear-gradient(
          0deg,
          rgba(0,0,0,.018) 0 1px,
          transparent 1px 7px
        ),
        /* edge wear */
        radial-gradient(circle at 12px 12px, rgba(0,0,0,.08) 0 2px, transparent 3px),
        radial-gradient(circle at 22px 26px, rgba(0,0,0,.06) 0 2px, transparent 3px),
        /* parchment base */
        linear-gradient(180deg, rgba(255,255,255,.70), rgba(255,255,255,.25)),
        linear-gradient(0deg, #f2dfb3, #f7edd6 40%, #f1dfb7);
      position: relative;
      overflow:hidden;
      padding: 16px 16px 58px;
    }

    /* Vignette for readability */
    .mc-page::after{
      content:"";
      position:absolute;
      inset:0;
      background:
        radial-gradient(circle at 50% 45%, transparent 55%, rgba(0,0,0,.10) 100%);
      pointer-events:none;
      mix-blend-mode: multiply;
      opacity:.55;
    }

    /* The center binding (thicker + darker like the screenshot) */
    .mc-binding{
      position:absolute;
      top: 18px;
      bottom: 18px;
      left: 50%;
      width: 26px;
      transform: translateX(-50%);
      border-radius: 10px;
      background:
        linear-gradient(180deg, rgba(255,255,255,.10), rgba(0,0,0,.28)),
        linear-gradient(90deg, #2a1408, #1d0f07 45%, #2a1408);
      border: 2px solid rgba(0,0,0,.55);
      box-shadow:
        inset 0 0 0 2px rgba(255,255,255,.08),
        inset 0 0 12px rgba(0,0,0,.30);
      z-index: 2;
      pointer-events:none;
    }

    /* Top row */
    .mc-page-top{
      display:flex;
      align-items:center;
      justify-content:space-between;
      margin-bottom: 10px;
      position: relative;
      z-index: 2; /* above vignette */
      font-size: 12px;
      letter-spacing: .2px;
      opacity: 1;
      color: rgba(0,0,0,.62);
    }

    .mc-page-title{
      font-weight: 800;
      text-transform: uppercase;
      font-size: 11px;
    }

    .mc-page-close{
      width: 26px;
      height: 26px;
      border-radius: 6px;
      border: 1px solid rgba(0,0,0,.28);
      background: rgba(255,255,255,.40);
      display:flex;
      align-items:center;
      justify-content:center;
      font-weight: 900;
      user-select:none;
      opacity:.9;
    }

    .mc-lines{
      position: relative;
      z-index: 2;
      height: 100%;
      display:flex;
      flex-direction:column;
      gap: 10px;
    }

    .mc-hint{
      font-size: 12px;
      opacity: 1;
      margin: 0;
      color: rgba(0,0,0,.62);
    }

    /* Textarea + preview: dark ink */
    .mc-textarea{
      flex: 1;
      width: 100%;
      resize: none;
      border: 0;
      outline: none;
      background: transparent;
      font: 14px/1.55 ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      color: rgba(0,0,0,.86);
      caret-color: rgba(0,0,0,.86);
      padding: 2px 2px;
      text-shadow: none;
    }

    .mc-textarea::placeholder{
      color: rgba(0,0,0,.45);
    }

    .mc-preview{
      flex: 1;
      white-space: pre-wrap;
      overflow:auto;
      border-radius: 6px;
      border: 1px dashed rgba(0,0,0,.28);
      background: rgba(255,255,255,.42);
      padding: 10px 10px;
      font: 14px/1.55 ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      color: rgba(0,0,0,.86);
      text-shadow: none;
    }

    /* Footer buttons (Minecraft-like: squared + thick border + inset highlight) */
    .mc-page-footer{
      position:absolute;
      left: 16px;
      right: 16px;
      bottom: 12px;
      display:flex;
      gap: 10px;
      justify-content:center;
      align-items:center;
      z-index: 2;
    }

    .mc-btn{
      appearance: none;
      border: 2px solid rgba(0,0,0,.55);
      background:
        linear-gradient(180deg, rgba(255,255,255,.55), rgba(0,0,0,.10)),
        rgba(255,255,255,.26);
      padding: 10px 14px;
      border-radius: 6px;
      font-weight: 900;
      letter-spacing: .3px;
      cursor: pointer;
      transition: transform .08s ease, filter .12s ease;
      text-decoration:none;
      color: rgba(0,0,0,.80);
      display:inline-flex;
      align-items:center;
      justify-content:center;
      min-width: 120px;
      user-select:none;
      box-shadow:
        inset 0 0 0 2px rgba(255,255,255,.18),
        0 3px 0 rgba(0,0,0,.18);
    }

    .mc-btn:hover{ filter: brightness(1.04); }
    .mc-btn:active{
      transform: translateY(1px);
      box-shadow:
        inset 0 0 0 2px rgba(255,255,255,.14),
        0 2px 0 rgba(0,0,0,.18);
    }

    .mc-btn.primary{
      background:
        linear-gradient(180deg, rgba(255,255,255,.60), rgba(0,0,0,.12)),
        rgba(120, 190, 120, .36);
    }

    .mc-btn.secondary{
      background:
        linear-gradient(180deg, rgba(255,255,255,.58), rgba(0,0,0,.12)),
        rgba(255,255,255,.26);
    }

    /* Force ALL book text to be dark (prevents inheriting white from body theme) */
    .mc-book,
    .mc-page,
    .mc-page *{
      color: rgba(0,0,0,.82);
      text-shadow: none;
    }

    /* Mobile: stack pages like MC does in narrow view */
    @media (max-width: 720px){
      .mc-book{ aspect-ratio: 10 / 12; }
      .mc-pages{ grid-template-columns: 1fr; }
      .mc-binding{ display:none; }
    }
    .quest-toast{
      position: fixed;
      left: 50%;
      top: 16px;
      transform: translateX(-50%);
      z-index: 50;
      padding: 10px 14px;
      border-radius: 10px;
      border: 2px solid rgba(0,0,0,.55);
      background:
        linear-gradient(180deg, rgba(255,255,255,.62), rgba(0,0,0,.10)),
        rgba(255, 210, 225, .55);
      box-shadow: 0 12px 30px rgba(0,0,0,.25);
      font: 700 12px/1.2 ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      color: rgba(0,0,0,.85);
      letter-spacing: .2px;
      opacity: 0;
      pointer-events: none;
      transition: opacity .25s ease, transform .25s ease;
    }
    .quest-toast.show{
      opacity: 1;
      transform: translateX(-50%) translateY(2px);
    }

    /* ---------- Tiny helper line on page 2 ---------- */
    .mc-softline{
      margin: 8px 0 0;
      font-size: 12px;
      color: rgba(0,0,0,.62);
    }
  </style>
</head>

<body class="alt-page">
  <canvas id="bg" aria-hidden="true"></canvas>

  <!-- Quest toast (hidden until sign) -->
  <div class="quest-toast" id="questToast" aria-live="polite">
    Quest Updated: Choose our meal date üíó
  </div>

  <main class="stage">
    <section class="mc-book-wrap" aria-label="Minecraft Book and Quill">
      <div class="mc-book" role="group" aria-roledescription="Book">
        <div class="mc-binding" aria-hidden="true"></div>

        <div class="mc-pages">
          <!-- Left Page -->
          <div class="mc-page" aria-label="Page 1">
            <div class="mc-page-top">
              <div class="mc-page-title">Page 1 of 2</div>
              <div class="mc-page-close" aria-hidden="true">√ó</div>
            </div>

            <div class="mc-lines">
              <p class="mc-hint">Write your letter:</p>
              <textarea
                id="letterInput"
                class="mc-textarea"
                spellcheck="false"
                placeholder="Dear Valentine,

"
              ></textarea>
            </div>

            <div class="mc-page-footer">
              <button class="mc-btn primary" id="signBtn" type="button">Sign</button>
              <a class="mc-btn secondary" href="{% url 'home' %}">Back</a>
            </div>
          </div>

          <!-- Right Page -->
          <div class="mc-page" aria-label="Page 2">
            <div class="mc-page-top">
              <div class="mc-page-title">Page 2 of 2</div>
              <div class="mc-page-close" aria-hidden="true">√ó</div>
            </div>

            <div class="mc-lines">
              <p class="mc-hint">Preview:</p>
              <div id="letterPreview" class="mc-preview" aria-live="polite"></div>
              <p class="mc-softline" id="afterSignLine" style="display:none;">
                Now pick our meal so I can officially plan our date. ‚ú®
              </p>
            </div>

            <div class="mc-page-footer">
              <button class="mc-btn secondary" id="clearBtn" type="button">Clear</button>
              <!-- NEW: meal button -->
              <button class="mc-btn primary" id="openMealBtn" type="button" style="display:none;">
                Choose Meal
              </button>
              <a class="mc-btn secondary" href="{% url 'home' %}">Back</a>
            </div>
          </div>
        </div>

      </div>
    </section>
  </main>

  <script src="{% static 'ask/js/app.js' %}"></script>
  <script src="{% static 'ask/js/meal.js' %}"></script>

  <script>
    (function(){
      const input = document.getElementById("letterInput");
      const preview = document.getElementById("letterPreview");
      const signBtn = document.getElementById("signBtn");
      const clearBtn = document.getElementById("clearBtn");

      const openMealBtn = document.getElementById("openMealBtn");
      const afterSignLine = document.getElementById("afterSignLine");
      const questToast = document.getElementById("questToast");

      const render = () => { preview.textContent = input.value || ""; };
      input.addEventListener("input", render);
      render();

      function showToast(msg){
        if (msg) questToast.textContent = msg;
        questToast.classList.add("show");
        window.setTimeout(() => questToast.classList.remove("show"), 1800);
      }

      signBtn.addEventListener("click", () => {
        input.blur();
        signBtn.textContent = "Signed";
        signBtn.disabled = true;
        signBtn.style.opacity = "0.85";

        // Reveal meal step
        openMealBtn.style.display = "inline-flex";
        afterSignLine.style.display = "block";

        // Quest toast + auto-open meal modal
        showToast("Quest Updated: Choose our meal date üíó");
        window.setTimeout(() => {
          // meal.js will listen to this (see tiny hook below)
          window.dispatchEvent(new CustomEvent("openMealQuest"));
        }, 650);
      });

      clearBtn.addEventListener("click", () => {
        input.value = "";
        render();
        signBtn.disabled = false;
        signBtn.textContent = "Sign";
        openMealBtn.style.display = "none";
        afterSignLine.style.display = "none";
        input.focus();
      });
    })();
  </script>
  window.addEventListener("openMealQuest", () => {
  // open immediately even if button isn‚Äôt clicked
  openMealModal();
});
</body>
</html>

